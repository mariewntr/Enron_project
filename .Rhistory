#for the email we use na.rm = TRUE to allow the sum to be done
sum_email_mark_to_market = sum(email_mark_to_market, na.rm = TRUE),
sum_email_10K_report = sum(email_10K_report, na.rm = TRUE),
sum_email_losing_money = sum(email_losing_money, na.rm = TRUE),
sum_email_SEC_investigation = sum(email_SEC_investigation, na.rm = TRUE),
sum_email_fear_feeling = sum(email_fear_feeling, na.rm = TRUE),
sum_email_correction = sum(email_correction, na.rm = TRUE),
sum_email_bankruptcy = sum(email_bankruptcy, na.rm = TRUE)) %>% ungroup() %>%
#keep one line per year and month
distinct(year_month, sum_topic_meeting, sum_topic_business_process, sum_topic_core_business, sum_topic_enron_event, sum_email_mark_to_market,
sum_email_10K_report,
sum_email_losing_money,
sum_email_SEC_investigation,
sum_email_fear_feeling,
sum_email_correction,
sum_email_bankruptcy)
extern_email %>% distinct(date, sender, recipient, subject, reference) %>%
mutate(#count the number of email which contain at least one word in the list of each topic
topic_meeting = if_else(str_detect(subject, topic_meeting), 1, 0),
topic_business_process = if_else(str_detect(subject, topic_business_process), 1, 0),
topic_core_business = if_else(str_detect(subject, topic_core_business), 1, 0),
topic_enron_event = if_else(str_detect(subject, topic_enron_event), 1, 0),
email_mark_to_market = if_else(str_detect(reference,"mark-to-market"), 1, 0),
email_10K_report = if_else(str_detect(reference, "10-K"), 1, 0),
email_losing_money = if_else(str_detect(reference, "losing money"), 1, 0),
email_SEC_investigation = if_else(str_detect(reference, "SEC"), 1, 0),
email_fear_feeling = if_else(str_detect(reference, "fears"), 1, 0),
email_correction = if_else(str_detect(reference,"correction"),1,0),
email_bankruptcy = if_else(str_detect(reference, "bankruptcy"), 1, 0),
#to get the date in year/month
year_month = as.Date(paste0(format(date,"%Y"),"-",format(date,"%m"),"-01"))) %>%
group_by(year_month) %>%
mutate(sum_topic_meeting = sum(topic_meeting),
sum_topic_business_process = sum(topic_business_process),
sum_topic_core_business = sum(topic_core_business),
sum_topic_enron_event = sum(topic_enron_event),
#for the email we use na.rm = TRUE to allow the sum to be done
sum_email_mark_to_market = sum(email_mark_to_market, na.rm = TRUE),
sum_email_10K_report = sum(email_10K_report, na.rm = TRUE),
sum_email_losing_money = sum(email_losing_money, na.rm = TRUE),
sum_email_SEC_investigation = sum(email_SEC_investigation, na.rm = TRUE),
sum_email_fear_feeling = sum(email_fear_feeling, na.rm = TRUE),
sum_email_correction = sum(email_correction, na.rm = TRUE),
sum_email_bankruptcy = sum(email_bankruptcy, na.rm = TRUE)) %>% ungroup() %>%
#keep one line per year and month
distinct(year_month, sum_topic_meeting, sum_topic_business_process, sum_topic_core_business, sum_topic_enron_event, sum_email_mark_to_market,
sum_email_10K_report,
sum_email_losing_money,
sum_email_SEC_investigation,
sum_email_fear_feeling,
sum_email_correction,
sum_email_bankruptcy)
extern_email %>% distinct(date, sender, recipient, subject, reference) %>%
filter(str_detect(subject, "enron|Enron") | str_detect(reference, "enron|Enron")) %>%
mutate(#count the number of email which contain at least one word in the list of each topic
topic_meeting = if_else(str_detect(subject, topic_meeting), 1, 0),
topic_business_process = if_else(str_detect(subject, topic_business_process), 1, 0),
topic_core_business = if_else(str_detect(subject, topic_core_business), 1, 0),
topic_enron_event = if_else(str_detect(subject, topic_enron_event), 1, 0),
email_mark_to_market = if_else(str_detect(reference,"mark-to-market"), 1, 0),
email_10K_report = if_else(str_detect(reference, "10-K"), 1, 0),
email_losing_money = if_else(str_detect(reference, "losing money"), 1, 0),
email_SEC_investigation = if_else(str_detect(reference, "SEC"), 1, 0),
email_fear_feeling = if_else(str_detect(reference, "fears"), 1, 0),
email_correction = if_else(str_detect(reference,"correction"),1,0),
email_bankruptcy = if_else(str_detect(reference, "bankruptcy"), 1, 0),
#to get the date in year/month
year_month = as.Date(paste0(format(date,"%Y"),"-",format(date,"%m"),"-01"))) %>%
group_by(year_month) %>%
mutate(sum_topic_meeting = sum(topic_meeting),
sum_topic_business_process = sum(topic_business_process),
sum_topic_core_business = sum(topic_core_business),
sum_topic_enron_event = sum(topic_enron_event),
#for the email we use na.rm = TRUE to allow the sum to be done
sum_email_mark_to_market = sum(email_mark_to_market, na.rm = TRUE),
sum_email_10K_report = sum(email_10K_report, na.rm = TRUE),
sum_email_losing_money = sum(email_losing_money, na.rm = TRUE),
sum_email_SEC_investigation = sum(email_SEC_investigation, na.rm = TRUE),
sum_email_fear_feeling = sum(email_fear_feeling, na.rm = TRUE),
sum_email_correction = sum(email_correction, na.rm = TRUE),
sum_email_bankruptcy = sum(email_bankruptcy, na.rm = TRUE)) %>% ungroup() %>%
#keep one line per year and month
distinct(year_month, sum_topic_meeting, sum_topic_business_process, sum_topic_core_business, sum_topic_enron_event, sum_email_mark_to_market,
sum_email_10K_report,
sum_email_losing_money,
sum_email_SEC_investigation,
sum_email_fear_feeling,
sum_email_correction,
sum_email_bankruptcy)
extern_email %>% distinct(date, sender, recipient, subject, reference) %>%
#filter for the email
#filter(str_detect(subject, "enron|Enron") | str_detect(reference, "enron|Enron")) %>%
mutate(#count the number of email which contain at least one word in the list of each topic
topic_meeting = if_else(str_detect(subject, topic_meeting), 1, 0),
topic_business_process = if_else(str_detect(subject, topic_business_process), 1, 0),
topic_core_business = if_else(str_detect(subject, topic_core_business), 1, 0),
topic_enron_event = if_else(str_detect(subject, topic_enron_event), 1, 0),
email_mark_to_market = if_else(str_detect(reference,"mark-to-market"), 1, 0),
email_10K_report = if_else(str_detect(reference, "10-K"), 1, 0),
email_losing_money = if_else(str_detect(reference, "losing money"), 1, 0),
email_SEC_investigation = if_else(str_detect(reference, "SEC"), 1, 0),
email_fear_feeling = if_else(str_detect(reference, "fears"), 1, 0),
email_correction = if_else(str_detect(reference,"correction"),1,0),
email_bankruptcy = if_else(str_detect(reference, "bankruptcy"), 1, 0),
#to get the date in year/month
year_month = as.Date(paste0(format(date,"%Y"),"-",format(date,"%m"),"-01"))) %>%
group_by(year_month) %>%
mutate(sum_topic_meeting = sum(topic_meeting),
sum_topic_business_process = sum(topic_business_process),
sum_topic_core_business = sum(topic_core_business),
sum_topic_enron_event = sum(topic_enron_event),
#for the email we use na.rm = TRUE to allow the sum to be done
sum_email_mark_to_market = sum(email_mark_to_market, na.rm = TRUE),
sum_email_10K_report = sum(email_10K_report, na.rm = TRUE),
sum_email_losing_money = sum(email_losing_money, na.rm = TRUE),
sum_email_SEC_investigation = sum(email_SEC_investigation, na.rm = TRUE),
sum_email_fear_feeling = sum(email_fear_feeling, na.rm = TRUE),
sum_email_correction = sum(email_correction, na.rm = TRUE),
sum_email_bankruptcy = sum(email_bankruptcy, na.rm = TRUE)) %>% ungroup() %>%
#keep one line per year and month
distinct(year_month, sum_topic_meeting, sum_topic_business_process, sum_topic_core_business, sum_topic_enron_event, sum_email_mark_to_market,
sum_email_10K_report,
sum_email_losing_money,
sum_email_SEC_investigation,
sum_email_fear_feeling,
sum_email_correction,
sum_email_bankruptcy)
extern_email %>% distinct(date, sender, recipient, subject, reference) %>%
#filter for the email having in their subject enron
filter(str_detect(subject, "enron|Enron") | str_detect(reference, "enron|Enron")) %>%
mutate(#count the number of email which contain at least one word in the list of each topic
topic_meeting = if_else(str_detect(subject, topic_meeting), 1, 0),
topic_business_process = if_else(str_detect(subject, topic_business_process), 1, 0),
topic_core_business = if_else(str_detect(subject, topic_core_business), 1, 0),
topic_enron_event = if_else(str_detect(subject, topic_enron_event), 1, 0),
email_mark_to_market = if_else(str_detect(reference,"mark-to-market"), 1, 0),
email_10K_report = if_else(str_detect(reference, "10-K"), 1, 0),
email_losing_money = if_else(str_detect(reference, "losing money"), 1, 0),
email_SEC_investigation = if_else(str_detect(reference, "SEC"), 1, 0),
email_fear_feeling = if_else(str_detect(reference, "fears"), 1, 0),
email_correction = if_else(str_detect(reference,"correction"),1,0),
email_bankruptcy = if_else(str_detect(reference, "bankruptcy"), 1, 0),
#to get the date in year/month
year_month = as.Date(paste0(format(date,"%Y"),"-",format(date,"%m"),"-01"))) %>%
group_by(year_month) %>%
mutate(sum_topic_meeting = sum(topic_meeting),
sum_topic_business_process = sum(topic_business_process),
sum_topic_core_business = sum(topic_core_business),
sum_topic_enron_event = sum(topic_enron_event),
#for the email we use na.rm = TRUE to allow the sum to be done
sum_email_mark_to_market = sum(email_mark_to_market, na.rm = TRUE),
sum_email_10K_report = sum(email_10K_report, na.rm = TRUE),
sum_email_losing_money = sum(email_losing_money, na.rm = TRUE),
sum_email_SEC_investigation = sum(email_SEC_investigation, na.rm = TRUE),
sum_email_fear_feeling = sum(email_fear_feeling, na.rm = TRUE),
sum_email_correction = sum(email_correction, na.rm = TRUE),
sum_email_bankruptcy = sum(email_bankruptcy, na.rm = TRUE)) %>% ungroup() %>%
#keep one line per year and month
distinct(year_month, sum_topic_meeting, sum_topic_business_process, sum_topic_core_business, sum_topic_enron_event, sum_email_mark_to_market,
sum_email_10K_report,
sum_email_losing_money,
sum_email_SEC_investigation,
sum_email_fear_feeling,
sum_email_correction,
sum_email_bankruptcy)
extern_email %>% distinct(date, sender, recipient, subject, reference) %>%
#filter for the email having in their subject enron
filter(str_detect(subject, "enron|Enron") | str_detect(reference, "enron|Enron")) %>%
mutate(#count the number of email which contain at least one word in the list of each topic
topic_meeting = if_else(str_detect(subject, topic_meeting), 1, 0),
topic_business_process = if_else(str_detect(subject, topic_business_process), 1, 0),
topic_core_business = if_else(str_detect(subject, topic_core_business), 1, 0),
topic_enron_event = if_else(str_detect(subject, topic_enron_event), 1, 0),
email_mark_to_market = if_else(str_detect(reference,"mark-to-market"), 1, 0),
email_10K_report = if_else(str_detect(reference, "10-K"), 1, 0),
email_losing_money = if_else(str_detect(reference, "losing money"), 1, 0),
email_SEC_investigation = if_else(str_detect(reference, "SEC"), 1, 0),
email_fear_feeling = if_else(str_detect(reference, "fears"), 1, 0),
email_correction = if_else(str_detect(reference,"correction"),1,0),
email_bankruptcy = if_else(str_detect(reference, "bankruptcy"), 1, 0),
#to get the date in year/month
year_month = as.Date(paste0(format(date,"%Y"),"-",format(date,"%m"),"-01"))) %>%
group_by(year_month) %>%
mutate(sum_topic_meeting = sum(topic_meeting),
sum_topic_business_process = sum(topic_business_process),
sum_topic_core_business = sum(topic_core_business),
sum_topic_enron_event = sum(topic_enron_event),
#for the email we use na.rm = TRUE to allow the sum to be done
sum_email_mark_to_market = sum(email_mark_to_market, na.rm = TRUE),
sum_email_10K_report = sum(email_10K_report, na.rm = TRUE),
sum_email_losing_money = sum(email_losing_money, na.rm = TRUE),
sum_email_SEC_investigation = sum(email_SEC_investigation, na.rm = TRUE),
sum_email_fear_feeling = sum(email_fear_feeling, na.rm = TRUE),
sum_email_correction = sum(email_correction, na.rm = TRUE),
sum_email_bankruptcy = sum(email_bankruptcy, na.rm = TRUE)) %>% ungroup() %>%
#keep one line per year and month
distinct(year_month, sum_topic_meeting, sum_topic_business_process, sum_topic_core_business, sum_topic_enron_event, sum_email_mark_to_market,
sum_email_10K_report,
sum_email_losing_money,
sum_email_SEC_investigation,
sum_email_fear_feeling,
sum_email_correction,
sum_email_bankruptcy) %>% select(year_month, starts_with("sum_topic_")) %>%
#change the orientation of the data set
pivot_longer(
cols = 2:5,
names_to = "topics",
values_to = "value") %>%
#scatter plot and trend line
ggplot(aes(year_month,value, color=topics))+
geom_line(size = 1)+
#label, axis, and legend
labs(color = "Email subject topics",
title = "Email send or received by person whose haven't an enron email address in function of their subject",
x = "year",
y = "Number of email") +
#to display the year and month, every 3 months for a better reading
scale_x_date(date_labels = "%Y-%m", date_breaks = "3 months")+
scale_color_manual(#to get only the customization for the email categories
values = topic_colors[8:11],
labels = topic_label[8:11])
extern_email_graph <- extern_email %>% distinct(date, sender, recipient, subject, reference) %>%
#filter for the email having in their subject enron
filter(str_detect(subject, "enron|Enron") | str_detect(reference, "enron|Enron")) %>%
mutate(#count the number of email which contain at least one word in the list of each topic
topic_meeting = if_else(str_detect(subject, topic_meeting), 1, 0),
topic_business_process = if_else(str_detect(subject, topic_business_process), 1, 0),
topic_core_business = if_else(str_detect(subject, topic_core_business), 1, 0),
topic_enron_event = if_else(str_detect(subject, topic_enron_event), 1, 0),
email_mark_to_market = if_else(str_detect(reference,"mark-to-market"), 1, 0),
email_10K_report = if_else(str_detect(reference, "10-K"), 1, 0),
email_losing_money = if_else(str_detect(reference, "losing money"), 1, 0),
email_SEC_investigation = if_else(str_detect(reference, "SEC"), 1, 0),
email_fear_feeling = if_else(str_detect(reference, "fears"), 1, 0),
email_correction = if_else(str_detect(reference,"correction"),1,0),
email_bankruptcy = if_else(str_detect(reference, "bankruptcy"), 1, 0),
#to get the date in year/month
year_month = as.Date(paste0(format(date,"%Y"),"-",format(date,"%m"),"-01"))) %>%
group_by(year_month) %>%
mutate(sum_topic_meeting = sum(topic_meeting),
sum_topic_business_process = sum(topic_business_process),
sum_topic_core_business = sum(topic_core_business),
sum_topic_enron_event = sum(topic_enron_event),
#for the email we use na.rm = TRUE to allow the sum to be done
sum_email_mark_to_market = sum(email_mark_to_market, na.rm = TRUE),
sum_email_10K_report = sum(email_10K_report, na.rm = TRUE),
sum_email_losing_money = sum(email_losing_money, na.rm = TRUE),
sum_email_SEC_investigation = sum(email_SEC_investigation, na.rm = TRUE),
sum_email_fear_feeling = sum(email_fear_feeling, na.rm = TRUE),
sum_email_correction = sum(email_correction, na.rm = TRUE),
sum_email_bankruptcy = sum(email_bankruptcy, na.rm = TRUE)) %>% ungroup() %>%
#keep one line per year and month
distinct(year_month, sum_topic_meeting, sum_topic_business_process, sum_topic_core_business, sum_topic_enron_event, sum_email_mark_to_market,
sum_email_10K_report,
sum_email_losing_money,
sum_email_SEC_investigation,
sum_email_fear_feeling,
sum_email_correction,
sum_email_bankruptcy)
#graph of the email speaking about enron and which could be speaking about enron event/business process
extern_email_graph %>% select(year_month, starts_with("sum_topic_")) %>%
#change the orientation of the data set
pivot_longer(
cols = 2:5,
names_to = "topics",
values_to = "value") %>%
#scatter plot and trend line
ggplot(aes(year_month,value, color=topics))+
geom_line(size = 1)+
#label, axis, and legend
labs(color = "Email subject topics",
title = "Email send/received about enron event",
subtitle = "Email exchange about Enron between person whose haven't an enron email address",
x = "year",
y = "Number of email") +
#to display the year and month, every 3 months for a better reading
scale_x_date(date_labels = "%Y-%m", date_breaks = "3 months")+
scale_color_manual(#to get only the customization for the email categories
values = topic_colors[8:11],
labels = topic_label[8:11])
#graph of the email speaking about enron and which could be speaking about enron event/business process
extern_email_graph %>% select(year_month, starts_with("sum_email_")) %>%
#change the orientation of the data set
pivot_longer(
cols = 2:5,
names_to = "topics",
values_to = "value") %>%
#scatter plot and trend line
ggplot(aes(year_month,value, color=topics))+
geom_line(size = 1)+
#label, axis, and legend
labs(color = "Email key words",
title = "Email send/received about enron event",
subtitle = "Email exchange about Enron between person whose haven't an enron email address",
x = "year",
y = "Number of email") +
#to display the year and month, every 3 months for a better reading
scale_x_date(date_labels = "%Y-%m", date_breaks = "3 months")+
scale_color_manual(#to get only the customization for the email categories
values = topic_colors[1:7],
labels = topic_label[1:7])
extern_email_graph <- extern_email %>% distinct(date, sender, recipient, subject, reference) %>%
#filter for the email having in their subject enron
filter(str_detect(subject, "enron|Enron") | str_detect(reference, "enron|Enron")) %>%
mutate(#count the number of email which contain at least one word in the list of each topic
topic_meeting = if_else(str_detect(subject, topic_meeting), 1, 0),
topic_business_process = if_else(str_detect(subject, topic_business_process), 1, 0),
topic_core_business = if_else(str_detect(subject, topic_core_business), 1, 0),
topic_enron_event = if_else(str_detect(subject, topic_enron_event), 1, 0),
email_mark_to_market = if_else(str_detect(reference,"mark-to-market"), 1, 0),
email_10K_report = if_else(str_detect(reference, "10-K"), 1, 0),
email_losing_money = if_else(str_detect(reference, "losing money"), 1, 0),
email_SEC_investigation = if_else(str_detect(reference, "SEC"), 1, 0),
email_fear_feeling = if_else(str_detect(reference, "fears"), 1, 0),
email_correction = if_else(str_detect(reference,"correction"),1,0),
email_bankruptcy = if_else(str_detect(reference, "bankruptcy"), 1, 0),
#to get the date in year/month
year_month = as.Date(paste0(format(date,"%Y"),"-",format(date,"%m"),"-01"))) %>%
group_by(year_month) %>%
mutate(sum_topic_meeting = sum(topic_meeting),
sum_topic_business_process = sum(topic_business_process),
sum_topic_core_business = sum(topic_core_business),
sum_topic_enron_event = sum(topic_enron_event),
#for the email we use na.rm = TRUE to allow the sum to be done
sum_email_mark_to_market = sum(email_mark_to_market, na.rm = TRUE),
sum_email_10K_report = sum(email_10K_report, na.rm = TRUE),
sum_email_losing_money = sum(email_losing_money, na.rm = TRUE),
sum_email_SEC_investigation = sum(email_SEC_investigation, na.rm = TRUE),
sum_email_fear_feeling = sum(email_fear_feeling, na.rm = TRUE),
sum_email_correction = sum(email_correction, na.rm = TRUE),
sum_email_bankruptcy = sum(email_bankruptcy, na.rm = TRUE)) %>% ungroup() %>%
#keep one line per year and month
distinct(year_month, subject, sum_topic_meeting, sum_topic_business_process, sum_topic_core_business, sum_topic_enron_event, sum_email_mark_to_market,
sum_email_10K_report,
sum_email_losing_money,
sum_email_SEC_investigation,
sum_email_fear_feeling,
sum_email_correction,
sum_email_bankruptcy)
#graph of the email speaking about enron and which could be speaking about enron event/business process
extern_email_graph %>% select(year_month, starts_with("sum_topic_")) %>%
#change the orientation of the data set
pivot_longer(
cols = 2:5,
names_to = "topics",
values_to = "value") %>%
#scatter plot and trend line
ggplot(aes(year_month,value, color=topics))+
geom_line(size = 1)+
#label, axis, and legend
labs(color = "Email subject topics",
title = "Email send/received subject about enron event",
subtitle = "Email exchange about Enron between person whose haven't an enron email address",
x = "year",
y = "Number of email") +
#to display the year and month, every 3 months for a better reading
scale_x_date(date_labels = "%Y-%m", date_breaks = "3 months")+
scale_color_manual(#to get only the customization for the email categories
values = topic_colors[8:11],
labels = topic_label[8:11])
extern_email_graph %>% select(year_month, subject,starts_with("sum_topic_")) %>% filter(
(sum_topic_meeting != 0) | (sum_topic_business_process != 0) | (sum_topic_core_business != 0) | (sum_topic_enron_event != 0))
extern_email_graph <- extern_email %>% distinct(date, sender, recipient, subject, reference) %>%
#filter for the email having in their subject enron
#filter(str_detect(subject, "enron|Enron") | str_detect(reference, "enron|Enron")) %>%
mutate(#count the number of email which contain at least one word in the list of each topic
topic_meeting = if_else(str_detect(subject, topic_meeting), 1, 0),
topic_business_process = if_else(str_detect(subject, topic_business_process), 1, 0),
topic_core_business = if_else(str_detect(subject, topic_core_business), 1, 0),
topic_enron_event = if_else(str_detect(subject, topic_enron_event), 1, 0),
email_mark_to_market = if_else(str_detect(reference,"mark-to-market"), 1, 0),
email_10K_report = if_else(str_detect(reference, "10-K"), 1, 0),
email_losing_money = if_else(str_detect(reference, "losing money"), 1, 0),
email_SEC_investigation = if_else(str_detect(reference, "SEC"), 1, 0),
email_fear_feeling = if_else(str_detect(reference, "fears"), 1, 0),
email_correction = if_else(str_detect(reference,"correction"),1,0),
email_bankruptcy = if_else(str_detect(reference, "bankruptcy"), 1, 0),
#to get the date in year/month
year_month = as.Date(paste0(format(date,"%Y"),"-",format(date,"%m"),"-01"))) %>%
group_by(year_month) %>%
mutate(sum_topic_meeting = sum(topic_meeting),
sum_topic_business_process = sum(topic_business_process),
sum_topic_core_business = sum(topic_core_business),
sum_topic_enron_event = sum(topic_enron_event),
#for the email we use na.rm = TRUE to allow the sum to be done
sum_email_mark_to_market = sum(email_mark_to_market, na.rm = TRUE),
sum_email_10K_report = sum(email_10K_report, na.rm = TRUE),
sum_email_losing_money = sum(email_losing_money, na.rm = TRUE),
sum_email_SEC_investigation = sum(email_SEC_investigation, na.rm = TRUE),
sum_email_fear_feeling = sum(email_fear_feeling, na.rm = TRUE),
sum_email_correction = sum(email_correction, na.rm = TRUE),
sum_email_bankruptcy = sum(email_bankruptcy, na.rm = TRUE)) %>% ungroup() %>%
#keep one line per year and month
distinct(year_month, subject, sum_topic_meeting, sum_topic_business_process, sum_topic_core_business, sum_topic_enron_event, sum_email_mark_to_market,
sum_email_10K_report,
sum_email_losing_money,
sum_email_SEC_investigation,
sum_email_fear_feeling,
sum_email_correction,
sum_email_bankruptcy)
#graph of the email speaking about enron and which could be speaking about enron event/business process
extern_email_graph %>% select(year_month, starts_with("sum_topic_")) %>%
#change the orientation of the data set
pivot_longer(
cols = 2:5,
names_to = "topics",
values_to = "value") %>%
#scatter plot and trend line
ggplot(aes(year_month,value, color=topics))+
geom_line(size = 1)+
#label, axis, and legend
labs(color = "Email subject topics",
title = "Email send/received subject about enron event",
subtitle = "Email exchange about Enron between person whose haven't an enron email address",
x = "year",
y = "Number of email") +
#to display the year and month, every 3 months for a better reading
scale_x_date(date_labels = "%Y-%m", date_breaks = "3 months")+
scale_color_manual(#to get only the customization for the email categories
values = topic_colors[8:11],
labels = topic_label[8:11])
extern_email_graph <- extern_email %>% distinct(date, sender, recipient, subject, reference) %>%
#filter for the email having in their subject enron
filter(str_detect(subject, "enron|Enron") | str_detect(reference, "enron|Enron")) %>%
mutate(#count the number of email which contain at least one word in the list of each topic
topic_meeting = if_else(str_detect(subject, topic_meeting), 1, 0),
topic_business_process = if_else(str_detect(subject, topic_business_process), 1, 0),
topic_core_business = if_else(str_detect(subject, topic_core_business), 1, 0),
topic_enron_event = if_else(str_detect(subject, topic_enron_event), 1, 0),
email_mark_to_market = if_else(str_detect(reference,"mark-to-market"), 1, 0),
email_10K_report = if_else(str_detect(reference, "10-K"), 1, 0),
email_losing_money = if_else(str_detect(reference, "losing money"), 1, 0),
email_SEC_investigation = if_else(str_detect(reference, "SEC"), 1, 0),
email_fear_feeling = if_else(str_detect(reference, "fears"), 1, 0),
email_correction = if_else(str_detect(reference,"correction"),1,0),
email_bankruptcy = if_else(str_detect(reference, "bankruptcy"), 1, 0),
#to get the date in year/month
year_month = as.Date(paste0(format(date,"%Y"),"-",format(date,"%m"),"-01"))) %>%
group_by(year_month) %>%
mutate(sum_topic_meeting = sum(topic_meeting),
sum_topic_business_process = sum(topic_business_process),
sum_topic_core_business = sum(topic_core_business),
sum_topic_enron_event = sum(topic_enron_event),
#for the email we use na.rm = TRUE to allow the sum to be done
sum_email_mark_to_market = sum(email_mark_to_market, na.rm = TRUE),
sum_email_10K_report = sum(email_10K_report, na.rm = TRUE),
sum_email_losing_money = sum(email_losing_money, na.rm = TRUE),
sum_email_SEC_investigation = sum(email_SEC_investigation, na.rm = TRUE),
sum_email_fear_feeling = sum(email_fear_feeling, na.rm = TRUE),
sum_email_correction = sum(email_correction, na.rm = TRUE),
sum_email_bankruptcy = sum(email_bankruptcy, na.rm = TRUE)) %>% ungroup() %>%
#keep one line per year and month
distinct(year_month, subject, sum_topic_meeting, sum_topic_business_process, sum_topic_core_business, sum_topic_enron_event, sum_email_mark_to_market,
sum_email_10K_report,
sum_email_losing_money,
sum_email_SEC_investigation,
sum_email_fear_feeling,
sum_email_correction,
sum_email_bankruptcy)
#graph of the email speaking about enron and which could be speaking about enron event/business process
extern_email_graph %>% select(year_month, starts_with("sum_topic_")) %>%
#change the orientation of the data set
pivot_longer(
cols = 2:5,
names_to = "topics",
values_to = "value") %>%
#scatter plot and trend line
ggplot(aes(year_month,value, color=topics))+
geom_line(size = 1)+
#label, axis, and legend
labs(color = "Email subject topics",
title = "Email send/received subject about enron event",
subtitle = "Email exchange about Enron between person whose haven't an enron email address",
x = "year",
y = "Number of email") +
#to display the year and month, every 3 months for a better reading
scale_x_date(date_labels = "%Y-%m", date_breaks = "3 months")+
scale_color_manual(#to get only the customization for the email categories
values = topic_colors[8:11],
labels = topic_label[8:11])
extern_email_graph %>%
select(year_month, subject,starts_with("sum_topic_")) %>% filter(str_detect(subject, "enron|Enron") | str_detect(reference, "enron|Enron")) %>%
filter(
(sum_topic_meeting != 0) | (sum_topic_business_process != 0) | (sum_topic_core_business != 0) | (sum_topic_enron_event != 0))
extern_email_graph %>%
select(year_month, subject,starts_with("sum_topic_")) %>% filter(str_detect(subject, "enron|Enron")) %>%
filter(
(sum_topic_meeting != 0) | (sum_topic_business_process != 0) | (sum_topic_core_business != 0) | (sum_topic_enron_event != 0))
extern_email_graph %>%
select(year_month, subject,starts_with("sum_topic_")) %>%
filter(str_detect(subject, "enron|Enron")) %>%
filter((sum_topic_meeting != 0) | (sum_topic_business_process != 0) | (sum_topic_core_business != 0) | (sum_topic_enron_event != 0)) %>% distinct(year_month, subject, .keep_all = TRUE)
Enron_subject <- extern_email_graph %>%
select(year_month, subject,starts_with("sum_topic_")) %>%
filter(str_detect(subject, "enron|Enron")) %>%
filter((sum_topic_meeting != 0) | (sum_topic_business_process != 0) | (sum_topic_core_business != 0) | (sum_topic_enron_event != 0)) %>% distinct(year_month, subject, .keep_all = TRUE)
#drop the line whose seems to be extern exchange
no_extern <- df_message_status %>% select(date, sender, recipient, subject, reference) %>%
#count for each the sender and recipient whose have an enron email address
mutate(count_sender = if_else(str_detect(sender, "@enron"), 1, 0),
count_recipient = if_else(str_detect(recipient, "@enron"), 1,0)) %>%
#for each date and subject for each date make the sum of the sender and recipient with an enron email address
group_by(date, subject) %>% mutate(
sum_sender = sum(count_sender),
sum_recipient = sum(count_recipient)) %>% ungroup() %>%
#isolate the email exchange which not involved person with an enron email address
filter((sum_sender !=0) | (sum_recipient != 0)) %>% select(-c(count_sender, count_recipient, sum_sender, sum_recipient)) %>%
#transform all the string variable into factor data type
transform(sender = as.factor(sender),
recipient = as.factor(recipient))
verify <- inner_join(no_extern, Enron_subject, by = "subject")
verify
